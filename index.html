<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ET Attendance Fun Portal ‚Äì RVCE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.08);
      --text-main: #111827;
      --text-muted: #6b7280;
      --border: #e5e7eb;
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      font-family:"Poppins",system-ui,-apple-system;
      background:radial-gradient(circle at top,#e5f0ff,#f3f4f6);
      color:var(--text-main);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:1.2rem;
    }
    .shell{
      width:100%;
      max-width:1050px;
      background:var(--card-bg);
      border-radius:1.5rem;
      padding:1.5rem 1.6rem 1.7rem;
      border:1px solid var(--border);
      box-shadow:0 16px 40px rgba(15,23,42,0.15);
    }
    header{
      display:flex;
      justify-content:space-between;
      gap:1rem;
      flex-wrap:wrap;
      margin-bottom:1.1rem;
    }
    .title h1{font-size:1.4rem;font-weight:600;}
    .title p{font-size:0.86rem;color:var(--text-muted);margin-top:0.2rem;}
    .tag{
      font-size:0.75rem;
      padding:0.25rem 0.6rem;
      border-radius:999px;
      border:1px solid #d1d5db;
      background:#f9fafb;
      color:var(--text-muted);
      display:inline-flex;
      align-items:center;
      gap:0.3rem;
    }
    .tag-dot{
      width:7px;height:7px;border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 0 5px rgba(34,197,94,0.25);
    }

    .layout{
      display:grid;
      grid-template-columns:minmax(0,1.4fr) minmax(0,1fr);
      gap:1.1rem;
    }
    @media (max-width:900px){
      .layout{grid-template-columns:minmax(0,1fr);}
    }

    .card{
      background:#ffffff;
      border-radius:1.1rem;
      padding:1rem 1.05rem 1.2rem;
      border:1px solid #e5e7eb;
    }
    .card h2{
      font-size:0.98rem;
      margin-bottom:0.55rem;
      display:flex;
      align-items:center;
      gap:0.4rem;
    }
    .card h2 span.icon{
      width:24px;height:24px;border-radius:999px;
      background:var(--accent-soft);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:0.9rem;
      color:var(--accent);
    }

    .table-wrapper{
      border-radius:0.9rem;
      border:1px solid #e5e7eb;
      overflow:auto;
      max-height:340px;
      background:#f9fafb;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:0.78rem;
    }
    thead{
      position:sticky;
      top:0;
      background:#e5e7eb;
      z-index:1;
    }
    th,td{
      padding:0.42rem 0.52rem;
      border-bottom:1px solid #e5e7eb;
      text-align:left;
      white-space:nowrap;
    }
    th{font-weight:500;color:var(--text-muted);}
    tbody tr:nth-child(even){background:#f9fafb;}
    .play-btn{
      border:none;
      border-radius:999px;
      padding:0.32rem 0.75rem;
      font-size:0.75rem;
      cursor:pointer;
      background:var(--accent);
      color:#ffffff;
      font-weight:500;
    }
    .play-btn:hover{opacity:0.92;}

    .side-note{font-size:0.82rem;color:var(--text-muted);margin-bottom:0.7rem;}
    .side-bullets{
      font-size:0.8rem;
      list-style:none;
      padding-left:0;
      display:flex;
      flex-direction:column;
      gap:0.3rem;
      color:var(--text-muted);
    }
    .side-bullets li span{
      color:#111827;
      font-weight:500;
    }
    .note{
      margin-top:0.5rem;
      font-size:0.78rem;
      color:var(--text-muted);
    }

    .score-table-wrapper{
      margin-top:0.45rem;
      border-radius:0.9rem;
      border:1px solid #e5e7eb;
      overflow:auto;
      max-height:220px;
      background:#f9fafb;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:999px;
      padding:0.18rem 0.6rem;
      background:var(--accent-soft);
      font-size:0.76rem;
      color:var(--accent);
      font-weight:500;
      margin-bottom:0.3rem;
    }
    .empty-text{
      font-size:0.8rem;
      color:var(--text-muted);
      margin-top:0.4rem;
    }

    /* modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.35);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:40;
    }
    .modal{
      background:#ffffff;
      border-radius:1rem;
      padding:1rem 1.1rem 1rem;
      width:100%;
      max-width:360px;
      box-shadow:0 16px 40px rgba(15,23,42,0.55);
      border:1px solid #e5e7eb;
    }
    .modal-title{
      font-size:0.96rem;
      font-weight:600;
      margin-bottom:0.4rem;
    }
    .modal-sub{
      font-size:0.8rem;
      color:var(--text-muted);
      margin-bottom:0.4rem;
    }
    .modal-field{
      margin-bottom:0.6rem;
    }
    .modal-label{
      font-size:0.78rem;
      color:var(--text-muted);
      margin-bottom:0.18rem;
      display:block;
    }
    .modal-input{
      width:100%;
      padding:0.45rem 0.55rem;
      border-radius:0.6rem;
      border:1px solid #d1d5db;
      font-size:0.82rem;
    }
    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:0.4rem;
      margin-top:0.4rem;
    }
    .btn{
      padding:0.4rem 0.85rem;
      border-radius:999px;
      border:none;
      font-size:0.8rem;
      cursor:pointer;
    }
    .btn-secondary{
      background:#e5e7eb;
      color:#111827;
    }
    .btn-primary{
      background:var(--accent);
      color:#ffffff;
      font-weight:500;
    }
    .modal-error{
      font-size:0.76rem;
      color:#dc2626;
      margin-top:0.2rem;
      min-height:1em;
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="title">
        <h1>ET Attendance Game Portal ‚Äì 1st Sem</h1>
        <p>Select your name, verify USN, play 2 levels, then earn your trophy & YouTube ‚Äúprize‚Äù.</p>
      </div>
      <div>
        <div class="tag">
          <span class="tag-dot"></span>
          <span>Telecom ‚Ä¢ Section E</span>
        </div>
      </div>
    </header>

    <div class="layout">
      <!-- student list -->
     <section class="card">
  <h2><span class="icon">üìä</span>Class scoreboard</h2>
  <p class="side-note">
    This ranking is shared for everyone using this game. It combines:
  </p>
  <ul class="side-bullets">
    <li><span>Memory game time</span> ‚Äì faster is better.</li>
    <li><span>Quiz score</span> ‚Äì out of 5.</li>
    <li><span>Moves</span> ‚Äì fewer card flips is better.</li>
  </ul>
  <div class="badge">Top runs ‚Äì ET Section E</div>
  <div id="scoreWrapper" class="score-table-wrapper" style="display:none;">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Correct</th>
          <th>Time (s)</th>
          <th>Moves</th>
        </tr>
      </thead>
      <tbody id="scoreBody"></tbody>
    </table>
  </div>
  <div id="scoreEmpty" class="empty-text">
    No runs recorded yet. Play once to create the first entry.
  </div>
  <p class="note">
    For full class ranking & prize button, complete both levels and reach the final results page.
  </p>
</section>


      <!-- scoreboard + info -->
      
    </div>
  </div>

  <!-- login modal -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-title" id="modalTitle">Login</div>
      <div class="modal-sub" id="modalSub"></div>
      <div class="modal-field">
        <label class="modal-label" for="usnInput">Enter your RVCE USN exactly</label>
        <input id="usnInput" class="modal-input" placeholder="RVCE25BTE0XX" />
        <div id="modalError" class="modal-error"></div>
      </div>
      <div class="modal-actions">
        <button id="cancelBtn" class="btn btn-secondary">Cancel</button>
        <button id="continueBtn" class="btn btn-primary">Start Game</button>
      </div>
    </div>
  </div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    query,
    orderBy,
    limit,
    doc,
    getDoc,
    setDoc
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // üî• 1) SAME CONFIG AS index.html
 // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAcRrQIHYDctuKdc8QJTx8i5Gi_1b2QbNc",
  authDomain: "et-attendance-game.firebaseapp.com",
  projectId: "et-attendance-game",
  storageBucket: "et-attendance-game.firebasestorage.app",
  messagingSenderId: "398432369224",
  appId: "1:398432369224:web:2d4a76360b0ea3d99e367d",
  measurementId: "G-Z2793VJ1Z9"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);


  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const params = new URLSearchParams(window.location.search);
  const usn = (params.get("usn") || "").toUpperCase();
  const roll = params.get("roll");
  const name = params.get("name") || "";
  const time = parseFloat(params.get("time") || "0");
  const moves = parseInt(params.get("moves") || "0", 10);
  const correct = parseInt(params.get("correct") || "0", 10);

  const heroIcon = document.getElementById("heroIcon");
  const heroTitle = document.getElementById("heroTitle");
  const heroSub = document.getElementById("heroSub");
  const heroMe = document.getElementById("heroMe");
  const eggText = document.getElementById("eggText");
  const rankBadge = document.getElementById("rankBadge");
  const scoreLine = document.getElementById("scoreLine");
  const tableWrapper = document.getElementById("tableWrapper");
  const tableBody = document.getElementById("tableBody");
  const emptyText = document.getElementById("emptyText");

  const easterEggs = {
    "RVCE25BTE059": "Future problem solver ‚Äì just don‚Äôt debug your friends like code.",
    "RVCE25BTE051": "Always ready with an answer‚Ä¶ even when the question just changed.",
    "RVCE25BTE058": "Your notes are probably cleaner than half the textbooks.",
    "RVCE25BTE006": "Silently understanding everything, loudly judging everyone‚Äôs doubts.",
    "RVCE25BTE001": "Roll 1 energy: teacher‚Äôs radar is always on you.",
    "RVCE25BTE045": "Low-key genius, high-key pretending to be confused.",
    "RVCE25BTE055": "The type who says ‚ÄòI didn‚Äôt study‚Äô and then tops the test.",
    "RVCE25BTE015": "Your brain has more tabs open than your browser.",
    "RVCE25BTE016": "Can explain memes and maths with equal confidence.",
    "RVCE25BTE043": "If attendance was a subject, you‚Äôd probably get full marks.",
    "RVCE25BTE061": "Main character vibes in every lab group.",
    "RVCE25BTE041": "Your handwriting can either save or destroy the lab record.",
    "RVCE25BTE028": "Can crack jokes and circuits at the same time.",
    "RVCE25BTE011": "Teachers trust you. Your friends trust your screenshots.",
    "RVCE25BTE029": "Quiet in class, loud on WhatsApp status.",
    "RVCE25BTE044": "Knows the answer, waits to see if anyone else does first.",
    "RVCE25BTE019": "Always early to class, never early to submit assignments.",
    "RVCE25BTE032": "Knows how to find shortcuts‚Ä¶ in questions and corridors.",
    "RVCE25BTE038": "If overthinking was a subject, you‚Äôd be the gold medalist.",
    "RVCE25BTE020": "Balances labs, lectures and late-night reels like a pro.",
    "RVCE25BTE014": "First to say ‚ÄòI‚Äôm dead‚Äô after seeing the question paper.",
    "RVCE25BTE018": "Makes group projects actually look like a team effort.",
    "RVCE25BTE025": "Has at least 3 backup plans for every viva.",
    "RVCE25BTE005": "Topper energy but still pretending to be chill.",
    "RVCE25BTE034": "Most likely to fix the network when Wi-Fi dies in class.",
    "RVCE25BTE035": "Knows everyone‚Äôs tea but never spills it in class.",
    "RVCE25BTE030": "May forget homework but never forgets punchlines.",
    "RVCE25BTE009": "You‚Äôre still Irfan‚Äôs official enemy‚Ä¶ but also secretly the main villain of this site.",
    "RVCE25BTE057": "Your laugh is probably louder than the fan in the classroom.",
    "RVCE25BTE053": "Will absolutely turn any lab experiment into a story.",
    "RVCE25BTE031": "You give strong ‚Äòexplain this once more‚Äô energy.",
    "RVCE25BTE021": "Probably the one reminding others about deadlines.",
    "RVCE25BTE033": "Lives life 50% in college, 50% in daydreams.",
    "RVCE25BTE048": "Your mood swings faster than the semester schedule.",
    "RVCE25BTE013": "CR mode: roasting, managing, and still submitting at 11:59 PM.",
    "RVCE25BTE060": "Your calm face hides 47 open tasks and 2 pending labs.",
    "RVCE25BTE004": "Makes everything look aesthetic, even circuit diagrams.",
    "RVCE25BTE026": "Attendance low, confidence high ‚Äì perfect balance.",
    "RVCE25BTE008": "Always ‚Äòjust reached‚Äô even when class started 15 mins ago.",
    "RVCE25BTE037": "Can speedrun assignments like a gaming level.",
    "RVCE25BTE012": "Your ‚Äòokay sir‚Äô has 5 different meanings.",
    "RVCE25BTE022": "Knows the entire classroom gossip but still acts innocent.",
    "RVCE25BTE047": "If talking was a sport, you‚Äôd be in nationals.",
    "RVCE25BTE023": "Probably the tech support of at least three friend groups.",
    "RVCE25BTE063": "Low battery, high chaos. But still somehow passes.",
    "RVCE25BTE017": "Seems quiet until the group chat becomes unhinged.",
    "RVCE25BTE049": "You treat every exam like a surprise quiz.",
    "RVCE25BTE024": "Your snack stash is the real reason friends visit your bench.",
    "RVCE25BTE003": "Backbench vibes with frontbench grades.",
    "RVCE25BTE010": "Can sleep in class and still answer when name is called.",
    "RVCE25BTE050": "Laptop always on, life always buffering.",
    "RVCE25BTE052": "The ‚ÄòI‚Äôll send notes‚Äô hero of the section.",
    "RVCE25BTE056": "Talks like exam is a joke, writes like rank 1 material.",
    "RVCE25BTE039": "Lab partner who actually knows where the probes connect.",
    "RVCE25BTE046": "CR‚Äôs secret backup when things get too chaotic.",
    "RVCE25BTE042": "May forget roll number, never forgets canteen timings.",
    "RVCE25BTE027": "Small in size, large in opinions.",
    "RVCE25BTE002": "Enters 5 mins late but still says ‚Äòarey just started only‚Äô.",
    "RVCE25BTE062": "Probably colour-codes notes and chaos both.",
    "RVCE25BTE036": "Gives strong ‚ÄòI‚Äôll figure it out somehow‚Äô energy.",
    "RVCE25BTE007": "Silently collecting knowledge and screenshots.",
    "RVCE25BTE054": "Always ready to help, especially when proxy is needed.",
    "RVCE25BTE040": "You bring main character energy to every bench you sit on."
  };

  function getRank(correct, time) {
    if (correct === 5 && time < 25) return "Legend";
    if (correct === 5) return "Topper";
    if (correct >= 3) return "Backbencher";
    return "Noob";
  }

  async function saveResultToFirestore() {
    if (!usn || !name || !roll || isNaN(time) || isNaN(correct)) return;

    const ref = doc(db, "scores", usn);
    const newEntry = {
      usn,
      name,
      roll: Number(roll),
      correct,
      time: Number(time.toFixed(2)),
      moves: isNaN(moves) ? 0 : moves,
      ts: Date.now()
    };

    try {
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, newEntry);
      } else {
        const old = snap.data();
        const better =
          newEntry.correct > old.correct ||
          (newEntry.correct === old.correct && newEntry.time < old.time) ||
          (newEntry.correct === old.correct && newEntry.time === old.time && newEntry.moves < (old.moves ?? Infinity));
        if (better) {
          await setDoc(ref, newEntry);
        }
      }
    } catch (err) {
      console.error("Error saving result:", err);
    }
  }

  function renderHero() {
    const rank = getRank(correct, time);
    heroMe.textContent = name
      ? `Logged in as ${name} (Roll ${roll || "?"}).`
      : "";
    scoreLine.innerHTML =
      `You scored <strong>${correct}/5</strong> in the quiz, with a memory game time of <strong>${isNaN(time)? "0.00" : time.toFixed(2)}s</strong> and <strong>${isNaN(moves)? 0 : moves} moves</strong>.`;

    rankBadge.style.display = "inline-flex";
    rankBadge.textContent = rank;
    rankBadge.className = "rank-badge"; // reset
    if (rank==="Legend") {
      rankBadge.classList.add("rank-legend");
      heroIcon.textContent = "üëë";
      heroTitle.textContent = "Legend of ET!";
      heroSub.textContent = "Perfect performance and fast reflexes. MD officially salutes you.";
    } else if (rank==="Topper") {
      rankBadge.classList.add("rank-topper");
      heroIcon.textContent = "üèÜ";
      heroTitle.textContent = "Topper mode activated!";
      heroSub.textContent = "5/5 correct ‚Äì you definitely read more than just WhatsApp chats.";
    } else if (rank==="Backbencher") {
      rankBadge.classList.add("rank-backbencher");
      heroIcon.textContent = "üéñÔ∏è";
      heroTitle.textContent = "Certified Backbencher!";
      heroSub.textContent = "You may sit behind but your brain still shows up for exams.";
    } else {
      rankBadge.classList.add("rank-noob");
      heroIcon.textContent = "ü•â";
      heroTitle.textContent = "Respect for trying!";
      heroSub.textContent = "Noob rank today, legend potential tomorrow. Or at least pass in externals.";
    }

    const egg = easterEggs[usn] || "You unlocked a secret level: survive this semester with your sanity intact.";
    eggText.textContent = "Secret note: " + egg;
  }

  async function renderScoreboard() {
    try {
      const qRef = query(
        collection(db, "scores"),
        orderBy("correct", "desc"),
        orderBy("time", "asc"),
        orderBy("moves", "asc"),
        limit(100)
      );
      const snap = await getDocs(qRef);

      if (snap.empty) {
        tableWrapper.style.display = "none";
        emptyText.style.display = "block";
        return;
      }

      tableBody.innerHTML = "";
      let rankNum = 1;
      snap.forEach(docSnap => {
        const d = docSnap.data();
        const r = getRank(d.correct, d.time);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${rankNum++}</td>
          <td>${d.name}</td>
          <td>${r}</td>
          <td>${d.correct}/5</td>
          <td>${d.time.toFixed ? d.time.toFixed(2) : d.time}</td>
          <td>${d.moves ?? 0}</td>
        `;
        tableBody.appendChild(tr);
      });

      tableWrapper.style.display = "block";
      emptyText.style.display = "none";
    } catch (err) {
      console.error("Error loading scoreboard:", err);
      tableWrapper.style.display = "none";
      emptyText.style.display = "block";
      emptyText.textContent = "Could not load scoreboard right now.";
    }
  }

  // üî• Run everything
  (async () => {
    await saveResultToFirestore();
    renderHero();
    await renderScoreboard();
  })();
</script>

  
</body>
</html>




